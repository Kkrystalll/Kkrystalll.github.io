<!DOCTYPE html>
<html>
	<head>
		
<title>ä½¿ç”¨ Ruby on Rails ä¸²æ¥ LINE å¿«é€Ÿæ§‹å»ºå¿ƒç†æ¸¬é©—-Quiet</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/image/favicon.ico">

<link rel="stylesheet" href="/css/index.css">



<meta name="keywords" content="Line,Ruby,Rails,">
<meta name="description" content="">


<script src="/js/jquery.min.js"></script>


<script src="/js/index.js"></script>


<script src="/js/fancybox.umd.js"></script>


<script src="/js/fancybox-images.js"></script>


<script src="/js/gitalk.min.js"></script>


<script src="/js/hljs.min.js"></script>
 
<script>hljs.highlightAll();</script>

	<meta name="generator" content="Hexo 6.3.0"></head>

	<body>
		<div class="header">
  <div class="header-top" id="header-top">
    <div class="h-left">
      <a href="/" class="h-title">
        <img src="/image/mugShot.jpeg" alt="Quiet" />
        <h1>Krystal çš„æ¡ƒèŠ±æº</h1>
      </a>
    </div>
    <div class="h-right">
      <ul>
         
        <li>
          <a href="/">
            é¦–é 
          </a>
          <span class="dot"></span>
        </li>
          
        <li>
          <a href="/archives">
            æ–‡ç« 
          </a>
          <span class="dot"></span>
        </li>
          
        <li>
          <a href="/categories">
            åˆ†é¡
          </a>
          <span class="dot"></span>
        </li>
          
        <li>
          <a href="/tags">
            æ¨™ç±¤
          </a>
          <span class="dot"></span>
        </li>
          
        <li>
          <a href="/links">
            é€£çµ
          </a>
          <span class="dot"></span>
        </li>
          
        <li>
          <a href="/about">
            é—œæ–¼
          </a>
          <span class="dot"></span>
        </li>
         
      </ul>
    </div>
    <div class="h-right-close">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        width="24"
        height="24"
      >
        <path fill="none" d="M0 0h24v24H0z" />
        <path
          d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"
          fill="rgba(68,68,68,1)"
        />
      </svg>
    </div>
  </div>
</div>
<div class="sidebar">
    <div class="topo">
        <h2>Krystal</h2>
    </div>
    <ul>
        
        <li>
            <a href="/">é¦–é </a>
        </li>
        
        <li>
            <a href="/archives">æ–‡ç« </a>
        </li>
        
        <li>
            <a href="/categories">åˆ†é¡</a>
        </li>
        
        <li>
            <a href="/tags">æ¨™ç±¤</a>
        </li>
        
        <li>
            <a href="/links">é€£çµ</a>
        </li>
        
        <li>
            <a href="/about">é—œæ–¼</a>
        </li>
        
    </ul>
    <div class="my_foot">
        
        <a target="_blank" rel="noopener" href="https://github.com/Kkrystalll">
            <img src="https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg/imggithub.png" alt="Quietä¸»é¢˜">
        </a>
        
    </div>
</div>
<div class='shelter'>
</div>
<style>
    .shelter{
        background-color: #333;
        opacity:0.5;
        cursor: pointer;
        display: none; 
        position: fixed;
        left: 0;
        top: 0; 
        right: 0;
        bottom: 0;
        z-index: 1998;
    }
    .sidebar {
        width: 66%;
        height: 100%;
        position: fixed;
        top: 0;
        right: -100%;
        bottom: 0;
        background: #fff;
        z-index: 1999;
        text-align: center;
        box-shadow: -6px 0 20px rgba(98, 94, 94, .815);
    }

    .topo {
        width: 100%;
        height: 200px;
        background: url(https://api.ixiaowai.cn/gqapi/gqapi.php) no-repeat;
        background-size: 100% 100%;
        position: relative;
        display: flex;
        align-items: flex-end
    }

    .topo h2 {
        color: #fff;
        z-index: 1;
        position: relative;
        margin: 0 0 10px 10px;
        font-size: 1.2em;
        box-sizing: border-box
    }

    .topo:before {
        content: '';
        background-image: url(/image/pattern.png);
        background-repeat: repeat;
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        width: 100%;
        z-index: 1
    }

    .sidebar ul {
        width: 100%;
        margin-top: 50px
    }

    .sidebar ul li {
        height: 50px;
        list-style: none;
        font-size: 1.2em;
        text-align: right;
        margin-right: 10px
    }

    .sidebar ul li a {
        display: grid;
        color: #5d606a;
        text-overflow: ellipsis;
        width: 100%;
        text-decoration: none
    }

    .my_foot {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        position: absolute;
        bottom: 0
    }

    .my_foot a {
        text-decoration: none;
        margin-right: 10px;
        display: inline-block
    }

    .my_foot a img {
        width: 30px;
        height: 30px
    }
</style>

<script>
    $( function () {
	$( '.h-right-close>svg' )
		.click( function () {
			$( '.sidebar' )
				.animate( {
					right: "0"
				}, 500 );
			$( '.shelter' )
				.fadeIn( "slow" )
		} );
	$( '.shelter' )
		.click( function ( e ) {
			$( '.sidebar' )
				.animate( {
					right: "-100%"
				}, 500 );
			$( '.shelter' )
				.fadeOut( "slow" )
		} )
} )

</script>

<div class="post">
    <div
  class="post-header-background post-header-color"
  style="
    background: url('');
  "
>
  <div class="post-header-background-content">
    <ul class="post-header-tag">
       
      <li><a href="/tags/Line">#Line</a></li>
      
      <li><a href="/tags/Ruby">#Ruby</a></li>
      
      <li><a href="/tags/Rails">#Rails</a></li>
       
    </ul>

    <h1>ä½¿ç”¨ Ruby on Rails ä¸²æ¥ LINE å¿«é€Ÿæ§‹å»ºå¿ƒç†æ¸¬é©—</h1>
    <div class="post-header-info">
      <div class="post-header-info-author">
        
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 20 20"
        >
          <g>
            <path
              fill="#12183A"
              d="M6.187 15.265A6.47 6.47 0 0 0 10 16.5a6.47 6.47 0 0 0 3.813-1.235A4.99 4.99 0 0 0 10 13.5a4.99 4.99 0 0 0-3.813 1.765zM5.082 14.25A6.485 6.485 0 0 1 10 12c1.965 0 3.726.872 4.918 2.25a6.5 6.5 0 1 0-9.836 0zM10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0-1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"
            ></path>
          </g>
        </svg>
        
        <span class="post-header-info-author-text">
          <a href="../../about"
            >Krystal</a
          ></span
        >
        <div class="post-header-info-author-categories">
          
          <a href="../../categories/Rails/" target="_blank">Rails</a>
          
        </div>
        <p>2024-09-07 23:11:02</p>
      </div>
    </div>
  </div>
</div>

    <div class="post-content" id="content">
  <div id="article" class="post-content-info">
    
    <div id="post-toc">
      <span class="post-toc-title">æ–‡ç« ç›®éŒ„</span>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Ruby-on-Rails-%E4%B8%B2%E6%8E%A5-LINE-%E5%BF%AB%E9%80%9F%E6%A7%8B%E5%BB%BA%E5%BF%83%E7%90%86%E6%B8%AC%E9%A9%97"><span class="toc-number">1.</span> <span class="toc-text">ä½¿ç”¨ Ruby on Rails ä¸²æ¥ LINE å¿«é€Ÿæ§‹å»ºå¿ƒç†æ¸¬é©—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%BB%BA%E7%AB%8B-Rails-%E5%B0%88%E6%A1%88%E5%8F%8A%E8%B3%87%E6%96%99%E8%A1%A8"><span class="toc-number">1.1.</span> <span class="toc-text">ä¸€ã€å»ºç«‹ Rails å°ˆæ¡ˆåŠè³‡æ–™è¡¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%A2%BA%E8%AA%8D-ruby-%E7%89%88%E6%9C%AC%EF%BC%8C%E7%A2%BA%E8%AA%8D%E6%9C%89%E5%AE%89%E8%A3%9D-ruby"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. ç¢ºèª ruby ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£ ruby</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%A2%BA%E8%AA%8D-rails-%E7%89%88%E6%9C%AC%EF%BC%8C%E7%A2%BA%E8%AA%8D%E6%9C%89%E5%AE%89%E8%A3%9D-rails"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. ç¢ºèª rails ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£ rails</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8-rails-%E5%BB%BA%E7%AB%8B%E5%90%8D%E7%82%BA-psychological-test-%E7%9A%84%E6%96%B0%E5%B0%88%E6%A1%88%EF%BC%88%E5%8F%AF%E4%BB%A5%E6%8F%9B%E6%88%90%E6%82%A8%E5%96%9C%E6%AD%A1%E7%9A%84%E5%B0%88%E6%A1%88%E5%90%8D%E7%A8%B1%EF%BC%89"><span class="toc-number">1.1.3.</span> <span class="toc-text">3. ä½¿ç”¨ rails å»ºç«‹åç‚º psychological_test çš„æ–°å°ˆæ¡ˆï¼ˆå¯ä»¥æ›æˆæ‚¨å–œæ­¡çš„å°ˆæ¡ˆåç¨±ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8-Visual-Studio-Code-%E7%B7%A8%E8%BC%AF%E5%99%A8%E6%89%93%E9%96%8B%E6%AD%A4-rails-%E5%B0%88%E6%A1%88"><span class="toc-number">1.1.4.</span> <span class="toc-text">4. ä½¿ç”¨ Visual Studio Code ç·¨è¼¯å™¨æ‰“é–‹æ­¤ rails å°ˆæ¡ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%9C%A8-Visual-Studio-Code-%E7%B7%A8%E8%BC%AF%E5%99%A8%E8%A3%A1%E9%96%8B%E7%B5%82%E7%AB%AF%E6%A9%9F%EF%BC%8C%E5%9C%A8%E7%B5%82%E7%AB%AF%E6%A9%9F%E5%85%A7%E4%B8%8B-rails-server%EF%BC%8C%E5%B0%87-rails-server-%E8%B7%91%E8%B5%B7%E4%BE%86"><span class="toc-number">1.1.5.</span> <span class="toc-text">5. åœ¨ Visual Studio Code ç·¨è¼¯å™¨è£¡é–‹çµ‚ç«¯æ©Ÿï¼Œåœ¨çµ‚ç«¯æ©Ÿå…§ä¸‹ rails serverï¼Œå°‡ rails server è·‘èµ·ä¾†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%89%93%E9%96%8B%E7%B6%B2%E9%A0%81%E6%90%9C%E5%B0%8B-http-localhost-3000-%E6%88%96-http-127-0-0-1-3000-%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E7%95%AB%E9%9D%A2"><span class="toc-number">1.1.6.</span> <span class="toc-text">6. æ‰“é–‹ç¶²é æœå°‹ http:&#x2F;&#x2F;localhost:3000&#x2F; æˆ– http:&#x2F;&#x2F;127.0.0.1:3000&#x2F; å¯ä»¥çœ‹åˆ°ç•«é¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E8%A8%AD%E8%A8%88%E8%B3%87%E6%96%99%E8%A1%A8"><span class="toc-number">1.1.7.</span> <span class="toc-text">7. è¨­è¨ˆè³‡æ–™è¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E4%BD%BF%E7%94%A8-Scaffold-%E4%BE%86%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90-Question-%E7%9A%84-CRUD"><span class="toc-number">1.1.8.</span> <span class="toc-text">8. ä½¿ç”¨ Scaffold ä¾†å¿«é€Ÿç”Ÿæˆ Question çš„ CRUD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E4%BD%BF%E7%94%A8-Scaffold-%E4%BE%86%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90-Result-%E7%9A%84-CRUD"><span class="toc-number">1.1.9.</span> <span class="toc-text">9. ä½¿ç”¨ Scaffold ä¾†å¿«é€Ÿç”Ÿæˆ Result çš„ CRUD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E5%9F%B7%E8%A1%8C%E6%95%B8%E6%93%9A%E5%BA%AB%E9%81%B7%E7%A7%BB%EF%BC%8C%E5%B0%87%E8%AE%8A%E6%9B%B4%E5%AF%AB%E9%80%B2%E8%B3%87%E6%96%99%E5%BA%AB%E4%B8%AD"><span class="toc-number">1.1.10.</span> <span class="toc-text">10. åŸ·è¡Œæ•¸æ“šåº«é·ç§»ï¼Œå°‡è®Šæ›´å¯«é€²è³‡æ–™åº«ä¸­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E6%89%93%E9%96%8B%E7%B6%B2%E7%B6%B2%E9%A0%81%E6%90%9C%E5%B0%8B-http-localhost-3000-questions-%E6%88%96-http-127-0-0-1-3000-questions-%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0-scaffold-%E7%94%9F%E6%88%90%E7%9A%84%E7%95%AB%E9%9D%A2"><span class="toc-number">1.1.11.</span> <span class="toc-text">11. æ‰“é–‹ç¶²ç¶²é æœå°‹ http:&#x2F;&#x2F;localhost:3000&#x2F;questions æˆ– http:&#x2F;&#x2F;127.0.0.1:3000&#x2F;questions å¯ä»¥çœ‹åˆ° scaffold ç”Ÿæˆçš„ç•«é¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%82%BA%E8%B3%87%E6%96%99%E8%A1%A8%E5%8A%A0%E4%B8%8A%E9%A9%97%E8%AD%89-amp-%E4%BF%AE%E6%94%B9%E9%A6%96%E9%A0%81"><span class="toc-number">1.2.</span> <span class="toc-text">äºŒã€ç‚ºè³‡æ–™è¡¨åŠ ä¸Šé©—è­‰ &amp; ä¿®æ”¹é¦–é </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A9%97%E8%AD%89-Question-%E5%BF%85%E5%A1%AB%E6%AC%84%E4%BD%8D"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. é©—è­‰ Question å¿…å¡«æ¬„ä½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%A9%97%E8%AD%89-Question-option-%E6%AC%84%E4%BD%8D%E9%95%B7%E5%BA%A6"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. é©—è­‰ Question option æ¬„ä½é•·åº¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B0%87-Question-index-%E4%BF%AE%E6%94%B9%E6%88%90%E9%A6%96%E9%A0%81"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. å°‡ Question index ä¿®æ”¹æˆé¦–é </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B4%E5%90%88-LINE-Messaging-API"><span class="toc-number">1.3.</span> <span class="toc-text">ä¸‰ã€æ•´åˆ LINE Messaging API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%BB%BA%E7%AB%8B-LINE-%E5%AE%98%E6%96%B9%E5%B8%B3%E8%99%9F%EF%BC%8C%E6%8B%BF%E5%8F%96-Channel-secret-%E5%8F%8A-Channel-access-token"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. å»ºç«‹ LINE å®˜æ–¹å¸³è™Ÿï¼Œæ‹¿å– Channel secret åŠ Channel access token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%A8%AD%E7%BD%AE-LINE-%E7%9A%84-ENV-%E5%9C%A8%E5%B0%88%E6%A1%88"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. è¨­ç½® LINE çš„ ENV åœ¨å°ˆæ¡ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%9D-line-bot-api-%E8%88%87-LINE-Messaging-API-%E9%80%B2%E8%A1%8C%E4%BA%92%E5%8B%95"><span class="toc-number">1.3.3.</span> <span class="toc-text">3. å®‰è£ line-bot-api èˆ‡ LINE Messaging API é€²è¡Œäº’å‹•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%9D-dotenv-rails-%E8%AE%80%E5%8F%96%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8"><span class="toc-number">1.3.4.</span> <span class="toc-text">4. å®‰è£ dotenv-rails è®€å–ç’°å¢ƒè®Šæ•¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%88%9D%E5%A7%8B%E5%8C%96-LINE-Bot-%E5%AE%A2%E6%88%B6%E7%AB%AF"><span class="toc-number">1.3.5.</span> <span class="toc-text">5. åˆå§‹åŒ– LINE Bot å®¢æˆ¶ç«¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%92%B0%E5%AF%AB%E4%BA%92%E5%8B%95%E9%82%8F%E8%BC%AF%E8%88%87-API-%E5%9B%9E%E6%87%89%E6%A9%9F%E5%88%B6"><span class="toc-number">1.4.</span> <span class="toc-text">å››ã€æ’°å¯«äº’å‹•é‚è¼¯èˆ‡ API å›æ‡‰æ©Ÿåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%BB%BA%E7%AB%8B-line-callback-%E8%B7%AF%E5%BE%91"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. å»ºç«‹ line callback è·¯å¾‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BB%BA%E7%AB%8B-line-controller"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. å»ºç«‹ line controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8E%A5%E6%94%B6-callback-%E8%A8%8A%E6%81%AF"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. æ¥æ”¶ callback è¨Šæ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-callback-%E9%82%8F%E8%BC%AF"><span class="toc-number">1.4.4.</span> <span class="toc-text">4. callback é‚è¼¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-handle-text-message-%E9%82%8F%E8%BC%AF"><span class="toc-number">1.4.5.</span> <span class="toc-text">5. handle_text_message é‚è¼¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-reply-message-%E9%82%8F%E8%BC%AF"><span class="toc-number">1.4.6.</span> <span class="toc-text">6. reply_message é‚è¼¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-start-test-%E9%82%8F%E8%BC%AF"><span class="toc-number">1.4.7.</span> <span class="toc-text">7. start_test é‚è¼¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-send-question-to-user-%E9%82%8F%E8%BC%AF"><span class="toc-number">1.4.8.</span> <span class="toc-text">8. send_question_to_user é‚è¼¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-handle-postback-%E9%82%8F%E8%BC%AF"><span class="toc-number">1.4.9.</span> <span class="toc-text">9. handle_postback é‚è¼¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E9%96%8B%E5%95%9F-NGROK-amp-%E8%A8%AD%E5%AE%9A-LINE-BOT-CALLBACK"><span class="toc-number">1.5.</span> <span class="toc-text">äº”ã€é–‹å•Ÿ NGROK &amp; è¨­å®š LINE BOT CALLBACK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%95%9F%E5%8B%95-ngrok-%E7%9B%A3%E8%81%BD-3000-port"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. å•Ÿå‹• ngrok ç›£è½ 3000 port</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B0%87%E7%B6%B2%E5%9D%80%E6%94%BE%E9%80%B2%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. å°‡ç¶²å€æ”¾é€²ç’°å¢ƒè®Šæ•¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%A8%AD%E5%AE%9A%E5%B0%88%E6%A1%88%E7%9A%84-hosts"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. è¨­å®šå°ˆæ¡ˆçš„ hosts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%A8%AD%E5%AE%9A-LINE-Messaging-API-Webhook-URL"><span class="toc-number">1.5.4.</span> <span class="toc-text">4. è¨­å®š LINE Messaging API Webhook URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%87%8D%E9%96%8B-server-%E4%B8%A6%E9%96%8B%E5%95%9F-LINE-%E5%AE%98%E6%96%B9%E5%B8%B3%E8%99%9F%E8%A9%A6%E8%A9%A6"><span class="toc-number">1.5.5.</span> <span class="toc-text">5. é‡é–‹ server ä¸¦é–‹å•Ÿ LINE å®˜æ–¹å¸³è™Ÿè©¦è©¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%BB%BA%E7%AB%8B%E5%95%8F%E9%A1%8C"><span class="toc-number">1.5.6.</span> <span class="toc-text">6. å»ºç«‹å•é¡Œ</span></a></li></ol></li></ol></li></ol>
    </div>
     <h1 id="ä½¿ç”¨-Ruby-on-Rails-ä¸²æ¥-LINE-å¿«é€Ÿæ§‹å»ºå¿ƒç†æ¸¬é©—"><a href="#ä½¿ç”¨-Ruby-on-Rails-ä¸²æ¥-LINE-å¿«é€Ÿæ§‹å»ºå¿ƒç†æ¸¬é©—" class="headerlink" title="ä½¿ç”¨ Ruby on Rails ä¸²æ¥ LINE å¿«é€Ÿæ§‹å»ºå¿ƒç†æ¸¬é©—"></a>ä½¿ç”¨ Ruby on Rails ä¸²æ¥ LINE å¿«é€Ÿæ§‹å»ºå¿ƒç†æ¸¬é©—</h1><p>æœ¬æ–‡æ˜¯æ ¹æ“šæˆ‘åœ¨ <a target="_blank" rel="noopener" href="https://hwdc.ithome.com.tw/2024">2024 Hello World Dev Conference</a> æ“”ä»»è¬›è€…ï¼Œä¸¦ä¸»æŒå·¥ä½œåŠçš„ç¶“é©—åˆ†äº«ã€‚</p>
<p>æœ¬ç¯‡æ–‡å°‡æœƒæ‰‹æŠŠæ‰‹æ•™å¤§å®¶å¾å»ºç«‹ Rails å°ˆæ¡ˆï¼Œåˆ°æ•´åˆç¬¬ä¸‰æ–¹ API (LINE BOT)ï¼Œæœ€å¾Œå¯¦ç¾åŸºæ–¼æŒ‰éˆ•é©…å‹•çš„æ¸¬é©—äº’å‹•çµæœã€‚</p>
<p><strong>è‡ªå‚™è£ç½®</strong></p>
<ul>
<li>é›»è…¦éœ€å…ˆå®‰è£å¥½ Ruby åŠ Rails</li>
<li>æœ‰ Visual Studio Code ç·¨è¼¯å™¨</li>
</ul>
<p>è‹¥é‚„æ²’æœ‰å®‰è£å¥½ Ruby åŠ Rails ï¼Œå¯ä»¥åƒè€ƒ <a target="_blank" rel="noopener" href="https://railsbook.tw/chapters/02-environment-setup">ç‚ºä½ è‡ªå·±å­¸ Ruby on Rails - ç’°å¢ƒè¨­å®š</a></p>
<h2 id="ä¸€ã€å»ºç«‹-Rails-å°ˆæ¡ˆåŠè³‡æ–™è¡¨"><a href="#ä¸€ã€å»ºç«‹-Rails-å°ˆæ¡ˆåŠè³‡æ–™è¡¨" class="headerlink" title="ä¸€ã€å»ºç«‹ Rails å°ˆæ¡ˆåŠè³‡æ–™è¡¨"></a>ä¸€ã€å»ºç«‹ Rails å°ˆæ¡ˆåŠè³‡æ–™è¡¨</h2><h3 id="1-ç¢ºèª-ruby-ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£-ruby"><a href="#1-ç¢ºèª-ruby-ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£-ruby" class="headerlink" title="1. ç¢ºèª ruby ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£ ruby"></a>1. ç¢ºèª ruby ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£ ruby</h3><pre><code>ruby -v
</code></pre>
<p>åªè¦æœ‰çœ‹åˆ°é¡ä¼¼ <code>ruby 3.3.1</code> ruby å¾Œé¢æœ‰ç‰ˆæœ¬è™Ÿå°±ä»£è¡¨æˆåŠŸï¼</p>
<h3 id="2-ç¢ºèª-rails-ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£-rails"><a href="#2-ç¢ºèª-rails-ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£-rails" class="headerlink" title="2. ç¢ºèª rails ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£ rails"></a>2. ç¢ºèª rails ç‰ˆæœ¬ï¼Œç¢ºèªæœ‰å®‰è£ rails</h3><pre><code>rails --version
</code></pre>
<p>åªè¦æœ‰çœ‹åˆ°é¡ä¼¼ <code>Rails 7.1.4</code> Rails å¾Œé¢æœ‰ç‰ˆæœ¬è™Ÿå°±ä»£è¡¨æˆåŠŸï¼</p>
<h3 id="3-ä½¿ç”¨-rails-å»ºç«‹åç‚º-psychological-test-çš„æ–°å°ˆæ¡ˆï¼ˆå¯ä»¥æ›æˆæ‚¨å–œæ­¡çš„å°ˆæ¡ˆåç¨±ï¼‰"><a href="#3-ä½¿ç”¨-rails-å»ºç«‹åç‚º-psychological-test-çš„æ–°å°ˆæ¡ˆï¼ˆå¯ä»¥æ›æˆæ‚¨å–œæ­¡çš„å°ˆæ¡ˆåç¨±ï¼‰" class="headerlink" title="3. ä½¿ç”¨ rails å»ºç«‹åç‚º psychological_test çš„æ–°å°ˆæ¡ˆï¼ˆå¯ä»¥æ›æˆæ‚¨å–œæ­¡çš„å°ˆæ¡ˆåç¨±ï¼‰"></a>3. ä½¿ç”¨ rails å»ºç«‹åç‚º <code>psychological_test</code> çš„æ–°å°ˆæ¡ˆï¼ˆå¯ä»¥æ›æˆæ‚¨å–œæ­¡çš„å°ˆæ¡ˆåç¨±ï¼‰</h3><pre><code>rails new psychological_test
</code></pre>
<h3 id="4-ä½¿ç”¨-Visual-Studio-Code-ç·¨è¼¯å™¨æ‰“é–‹æ­¤-rails-å°ˆæ¡ˆ"><a href="#4-ä½¿ç”¨-Visual-Studio-Code-ç·¨è¼¯å™¨æ‰“é–‹æ­¤-rails-å°ˆæ¡ˆ" class="headerlink" title="4. ä½¿ç”¨ Visual Studio Code ç·¨è¼¯å™¨æ‰“é–‹æ­¤ rails å°ˆæ¡ˆ"></a>4. ä½¿ç”¨ Visual Studio Code ç·¨è¼¯å™¨æ‰“é–‹æ­¤ rails å°ˆæ¡ˆ</h3><p><img src="/image/railsLinePsychological/1.png" alt="Visual Studio Code"></p>
<h3 id="5-åœ¨-Visual-Studio-Code-ç·¨è¼¯å™¨è£¡é–‹çµ‚ç«¯æ©Ÿï¼Œåœ¨çµ‚ç«¯æ©Ÿå…§ä¸‹-rails-serverï¼Œå°‡-rails-server-è·‘èµ·ä¾†"><a href="#5-åœ¨-Visual-Studio-Code-ç·¨è¼¯å™¨è£¡é–‹çµ‚ç«¯æ©Ÿï¼Œåœ¨çµ‚ç«¯æ©Ÿå…§ä¸‹-rails-serverï¼Œå°‡-rails-server-è·‘èµ·ä¾†" class="headerlink" title="5. åœ¨ Visual Studio Code ç·¨è¼¯å™¨è£¡é–‹çµ‚ç«¯æ©Ÿï¼Œåœ¨çµ‚ç«¯æ©Ÿå…§ä¸‹ rails serverï¼Œå°‡ rails server è·‘èµ·ä¾†"></a>5. åœ¨ Visual Studio Code ç·¨è¼¯å™¨è£¡é–‹çµ‚ç«¯æ©Ÿï¼Œåœ¨çµ‚ç«¯æ©Ÿå…§ä¸‹ rails serverï¼Œå°‡ rails server è·‘èµ·ä¾†</h3><p><img src="/image/railsLinePsychological/2.png" alt="rails å°ˆæ¡ˆè·‘èµ·ä¾†"></p>
<pre><code class="sh"># å•Ÿå‹• Rails å°ˆæ¡ˆ
rails server
# ä¹Ÿå¯ä»¥ç°¡å¯«æˆå¦‚ä¸‹
rails s
</code></pre>
<p>è‹¥æ˜¯é–‹æˆåŠŸå¯ä»¥åœ¨çµ‚ç«¯æ©Ÿçœ‹åˆ°é¡ä¼¼ä»¥ä¸‹ç•«é¢<br><img src="/image/railsLinePsychological/3.png" alt="rails s"></p>
<h3 id="6-æ‰“é–‹ç¶²é æœå°‹-http-localhost-3000-æˆ–-http-127-0-0-1-3000-å¯ä»¥çœ‹åˆ°ç•«é¢"><a href="#6-æ‰“é–‹ç¶²é æœå°‹-http-localhost-3000-æˆ–-http-127-0-0-1-3000-å¯ä»¥çœ‹åˆ°ç•«é¢" class="headerlink" title="6. æ‰“é–‹ç¶²é æœå°‹ http://localhost:3000/ æˆ– http://127.0.0.1:3000/ å¯ä»¥çœ‹åˆ°ç•«é¢"></a>6. æ‰“é–‹ç¶²é æœå°‹ <code>http://localhost:3000/</code> æˆ– <code>http://127.0.0.1:3000/</code> å¯ä»¥çœ‹åˆ°ç•«é¢</h3><p><img src="/image/railsLinePsychological/4.png" alt="rails å°ˆæ¡ˆ"></p>
<h3 id="7-è¨­è¨ˆè³‡æ–™è¡¨"><a href="#7-è¨­è¨ˆè³‡æ–™è¡¨" class="headerlink" title="7. è¨­è¨ˆè³‡æ–™è¡¨"></a>7. è¨­è¨ˆè³‡æ–™è¡¨</h3><p><img src="/image/railsLinePsychological/5.png" alt="question è³‡æ–™è¡¨"><br><img src="/image/railsLinePsychological/6.png" alt="result è³‡æ–™è¡¨"></p>
<h3 id="8-ä½¿ç”¨-Scaffold-ä¾†å¿«é€Ÿç”Ÿæˆ-Question-çš„-CRUD"><a href="#8-ä½¿ç”¨-Scaffold-ä¾†å¿«é€Ÿç”Ÿæˆ-Question-çš„-CRUD" class="headerlink" title="8. ä½¿ç”¨ Scaffold ä¾†å¿«é€Ÿç”Ÿæˆ Question çš„ CRUD"></a>8. ä½¿ç”¨ Scaffold ä¾†å¿«é€Ÿç”Ÿæˆ Question çš„ CRUD</h3><p>Rails çš„ Scaffold æ˜¯ä¸€å€‹å‘½ä»¤åˆ—å·¥å…·ï¼Œç”¨æ–¼è‡ªå‹•ç”ŸæˆåŸºç¤çš„ MVCï¼ˆModel ã€ View ã€ Controllerï¼‰çµæ§‹ï¼Œä»¥åŠé—œè¯ç›¸é—œçš„æ–‡ä»¶ï¼Œå¦‚ migrationã€ route å’Œæ¸¬è©¦ã€‚ç•¶éœ€è¦å¿«é€Ÿå»ºç«‹ä¸€å€‹ CRUDï¼ˆå»ºç«‹ã€è®€å–ã€æ›´æ–°ã€åˆªé™¤ï¼‰æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œéå¸¸é©åˆä½¿ç”¨ã€‚</p>
<pre><code># ä½¿ç”¨ Scaffold ä¾†ç”Ÿæˆä¸€å€‹åç‚º Question çš„ model åŠå…¶æ¬„ä½ç­‰

rails g scaffold Question title option_1 option_2 value_1 value_2
</code></pre>
<ul>
<li><code>rails g</code> : æ˜¯ rails ç”Ÿæˆçš„ç°¡å¯«ï¼Œå®ƒæ˜¯ Rails æä¾›çš„ä¸€å€‹æŒ‡ä»¤ï¼Œç”¨æ–¼ç”¢ç”Ÿå„ç¨®æ–‡ä»¶å’Œç¨‹å¼ç¢¼çµæ§‹ï¼Œä»¥åŠ é€Ÿé–‹ç™¼éç¨‹ã€‚</li>
<li><code>Question</code> : æ˜¯ä½ è¦å»ºç«‹çš„ model åç¨±</li>
<li><code>title option_1 option_2 value_1 value_2</code> : åœ¨ Question model è£¡é¢è¦çš„æ¬„ä½ï¼Œæ­£å¸¸æ‡‰è©²è¦å¯«æˆ<pre><code>rails g scaffold Question title:string option_1:string option_2:string value_1:string value_2:string
</code></pre>
<code>title:string</code> ç¿»æˆä¸­æ–‡æ„æ€å°±æ˜¯ <code>æ¬„ä½åç¨±:è³‡æ–™å‹æ…‹</code>ï¼Œä½†è‹¥è³‡æ–™å‹æ…‹æ˜¯ <code>string</code> ï¼Œå¯ä»¥ç°¡å¯«æˆ<pre><code>rails g scaffold Question title option_1 option_2 value_1 value_2
</code></pre>
</li>
</ul>
<h3 id="9-ä½¿ç”¨-Scaffold-ä¾†å¿«é€Ÿç”Ÿæˆ-Result-çš„-CRUD"><a href="#9-ä½¿ç”¨-Scaffold-ä¾†å¿«é€Ÿç”Ÿæˆ-Result-çš„-CRUD" class="headerlink" title="9. ä½¿ç”¨ Scaffold ä¾†å¿«é€Ÿç”Ÿæˆ Result çš„ CRUD"></a>9. ä½¿ç”¨ Scaffold ä¾†å¿«é€Ÿç”Ÿæˆ Result çš„ CRUD</h3><pre><code># ä½¿ç”¨ Scaffold ä¾†ç”Ÿæˆä¸€å€‹åç‚º Result çš„ model åŠå…¶æ¬„ä½ç­‰

rails g scaffold Result answers:json user_id
</code></pre>
<h3 id="10-åŸ·è¡Œæ•¸æ“šåº«é·ç§»ï¼Œå°‡è®Šæ›´å¯«é€²è³‡æ–™åº«ä¸­"><a href="#10-åŸ·è¡Œæ•¸æ“šåº«é·ç§»ï¼Œå°‡è®Šæ›´å¯«é€²è³‡æ–™åº«ä¸­" class="headerlink" title="10. åŸ·è¡Œæ•¸æ“šåº«é·ç§»ï¼Œå°‡è®Šæ›´å¯«é€²è³‡æ–™åº«ä¸­"></a>10. åŸ·è¡Œæ•¸æ“šåº«é·ç§»ï¼Œå°‡è®Šæ›´å¯«é€²è³‡æ–™åº«ä¸­</h3><pre><code>rails db:migrate
</code></pre>
<h3 id="11-æ‰“é–‹ç¶²ç¶²é æœå°‹-http-localhost-3000-questions-æˆ–-http-127-0-0-1-3000-questions-å¯ä»¥çœ‹åˆ°-scaffold-ç”Ÿæˆçš„ç•«é¢"><a href="#11-æ‰“é–‹ç¶²ç¶²é æœå°‹-http-localhost-3000-questions-æˆ–-http-127-0-0-1-3000-questions-å¯ä»¥çœ‹åˆ°-scaffold-ç”Ÿæˆçš„ç•«é¢" class="headerlink" title="11. æ‰“é–‹ç¶²ç¶²é æœå°‹ http://localhost:3000/questions æˆ– http://127.0.0.1:3000/questions å¯ä»¥çœ‹åˆ° scaffold ç”Ÿæˆçš„ç•«é¢"></a>11. æ‰“é–‹ç¶²ç¶²é æœå°‹ <code>http://localhost:3000/questions</code> æˆ– <code>http://127.0.0.1:3000/questions</code> å¯ä»¥çœ‹åˆ° scaffold ç”Ÿæˆçš„ç•«é¢</h3><p><img src="/image/railsLinePsychological/7.png" alt="question index é "></p>
<h2 id="äºŒã€ç‚ºè³‡æ–™è¡¨åŠ ä¸Šé©—è­‰-amp-ä¿®æ”¹é¦–é "><a href="#äºŒã€ç‚ºè³‡æ–™è¡¨åŠ ä¸Šé©—è­‰-amp-ä¿®æ”¹é¦–é " class="headerlink" title="äºŒã€ç‚ºè³‡æ–™è¡¨åŠ ä¸Šé©—è­‰ &amp; ä¿®æ”¹é¦–é "></a>äºŒã€ç‚ºè³‡æ–™è¡¨åŠ ä¸Šé©—è­‰ &amp; ä¿®æ”¹é¦–é </h2><h3 id="1-é©—è­‰-Question-å¿…å¡«æ¬„ä½"><a href="#1-é©—è­‰-Question-å¿…å¡«æ¬„ä½" class="headerlink" title="1. é©—è­‰ Question å¿…å¡«æ¬„ä½"></a>1. é©—è­‰ Question å¿…å¡«æ¬„ä½</h3><p>ä½¿ç”¨ rails model é©—è­‰çš„ presence æ–¹æ³•ï¼Œé©—è­‰æ¬„ä½ä¸€å®šæœ‰å€¼ï¼ˆä¸ç‚ºç©ºï¼‰<a target="_blank" rel="noopener" href="https://guides.rubyonrails.org/active_record_validations.html#presence">åƒè€ƒå®˜æ–¹æ–‡ä»¶è³‡æ–™</a></p>
<pre><code class="rb"># app/models/question.rb

validates :title, :option_1, :value_1, :option_2, :value_2, presence: true
</code></pre>
<h3 id="2-é©—è­‰-Question-option-æ¬„ä½é•·åº¦"><a href="#2-é©—è­‰-Question-option-æ¬„ä½é•·åº¦" class="headerlink" title="2. é©—è­‰ Question option æ¬„ä½é•·åº¦"></a>2. é©—è­‰ Question option æ¬„ä½é•·åº¦</h3><p>ä½¿ç”¨ rails model é©—è­‰çš„ length æ–¹æ³•ï¼Œé©—è­‰æ¬„ä½çš„é•·åº¦æœ€å¤§å€¼ï¼ˆæœ€å¤§ 20 å­—ï¼‰ <a target="_blank" rel="noopener" href="https://guides.rubyonrails.org/active_record_validations.html#length">åƒè€ƒå®˜æ–¹æ–‡ä»¶è³‡æ–™</a></p>
<pre><code class="rb"># app/models/question.rb

validates :option_1, :option_2, length: &#123; maximum: 20 &#125;
</code></pre>
<h3 id="3-å°‡-Question-index-ä¿®æ”¹æˆé¦–é "><a href="#3-å°‡-Question-index-ä¿®æ”¹æˆé¦–é " class="headerlink" title="3. å°‡ Question index ä¿®æ”¹æˆé¦–é "></a>3. å°‡ Question index ä¿®æ”¹æˆé¦–é </h3><p>è¨­å®š root ï¼Œä½¿æˆ‘å€‘å¯ä»¥åœ¨ç¶²é æœå°‹ <code>http://localhost:3000/</code> æˆ– <code>http://127.0.0.1:3000/</code> æ™‚ï¼Œå°±ç­‰åŒæ–¼æœå°‹ <code>http://localhost:3000/questions</code> æˆ– <code>http://127.0.0.1:3000/questions</code> çš„é é¢</p>
<pre><code class="rb"># config/routes.rb

root to: &quot;questions#index&quot;
</code></pre>
<h2 id="ä¸‰ã€æ•´åˆ-LINE-Messaging-API"><a href="#ä¸‰ã€æ•´åˆ-LINE-Messaging-API" class="headerlink" title="ä¸‰ã€æ•´åˆ LINE Messaging API"></a>ä¸‰ã€æ•´åˆ LINE Messaging API</h2><h3 id="1-å»ºç«‹-LINE-å®˜æ–¹å¸³è™Ÿï¼Œæ‹¿å–-Channel-secret-åŠ-Channel-access-token"><a href="#1-å»ºç«‹-LINE-å®˜æ–¹å¸³è™Ÿï¼Œæ‹¿å–-Channel-secret-åŠ-Channel-access-token" class="headerlink" title="1. å»ºç«‹ LINE å®˜æ–¹å¸³è™Ÿï¼Œæ‹¿å– Channel secret åŠ Channel access token"></a>1. å»ºç«‹ LINE å®˜æ–¹å¸³è™Ÿï¼Œæ‹¿å– Channel secret åŠ Channel access token</h3><p>è‹¥å°šæœªå»ºç«‹å¸³è™Ÿå¯ä»¥åƒè€ƒ <a href="https://kkrystalll.github.io/posts/create-line-official-account/">è¶…å…¨å»ºç«‹ LINE å®˜æ–¹å¸³è™Ÿæµç¨‹</a> æ–‡ç« æ­¥é©Ÿå»ºç«‹</p>
<h3 id="2-è¨­ç½®-LINE-çš„-ENV-åœ¨å°ˆæ¡ˆ"><a href="#2-è¨­ç½®-LINE-çš„-ENV-åœ¨å°ˆæ¡ˆ" class="headerlink" title="2. è¨­ç½® LINE çš„ ENV åœ¨å°ˆæ¡ˆ"></a>2. è¨­ç½® LINE çš„ ENV åœ¨å°ˆæ¡ˆ</h3><p>é€šå¸¸åœ¨å°ˆæ¡ˆä¸­ï¼Œæˆ‘å€‘æœƒå°‡å¯†é‘°æ”¾åœ¨ç’°å¢ƒè®Šæ•¸é˜²æ­¢æ´©æ¼ï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦æ‰‹å‹•åœ¨å°ˆæ¡ˆçš„æ ¹ç›®éŒ„å»ºç«‹ä¸€å€‹ <code>.env</code> çš„æª”æ¡ˆä¾†æ”¾å¯†é‘°ï¼Œè€Œæ­¤æª”æ¡ˆéœ€è¦åŠ å…¥ <code>.gitignore</code> ï¼Œç¢ºä¿æ­¤å¯†é‘°ä¸æœƒé€²å…¥ç‰ˆæ§ï¼ˆä½†åœ¨ rails æœ‰è‡ªå‹•é è¨­ <code>.env</code> é–‹é ­çš„æª”æ¡ˆéƒ½åŠ é€² <code>.gitignore</code>ï¼‰</p>
<pre><code class="rb"># .env

LINE_CHANNEL_SECRET=&lt;ä½ çš„ CHANNEL_SECRET&gt;
LINE_CHANNEL_TOKEN=&lt;ä½ çš„ CHANNEL_TOKEN&gt;
</code></pre>
<h3 id="3-å®‰è£-line-bot-api-èˆ‡-LINE-Messaging-API-é€²è¡Œäº’å‹•"><a href="#3-å®‰è£-line-bot-api-èˆ‡-LINE-Messaging-API-é€²è¡Œäº’å‹•" class="headerlink" title="3. å®‰è£ line-bot-api èˆ‡ LINE Messaging API é€²è¡Œäº’å‹•"></a>3. å®‰è£ line-bot-api èˆ‡ LINE Messaging API é€²è¡Œäº’å‹•</h3><p>æˆ‘å€‘éœ€è¦å®‰è£ <a target="_blank" rel="noopener" href="https://github.com/line/line-bot-sdk-ruby">line-bot-api</a> é€™å€‹å¥—ä»¶ä¾†è·Ÿ LINE Messaging API é€²è¡Œäº’å‹•ï¼Œé‚£åœ¨ rails å°ˆæ¡ˆè£¡ï¼Œæˆ‘å€‘éœ€è¦å®‰è£çš„å¥—ä»¶æœƒæ”¾åœ¨ <code>Gemfile</code> é€™å€‹æª”æ¡ˆè£¡ç®¡ç†</p>
<pre><code class="rb"># Gemfile

gem &#39;line-bot-api&#39;
</code></pre>
<p>ğŸ“<code>gem &#39;line-bot-api&#39;</code> å¯ä»¥æ”¾åœ¨å¤–å±¤ä»»æ„ä¸€è¡Œï¼Œåªéœ€æ³¨æ„ä¸è¦æ”¾åœ¨ group è£¡ï¼Œå› ç‚ºæ”¾åœ¨å¤–å±¤æ˜¯å…¨éƒ¨ç’°å¢ƒéƒ½éœ€è¦ç”¨åˆ°çš„</p>
<p>è‹¥æ˜¯åŠ ä¸Š gem â€˜line-bot-apiâ€™ å¾Œéœ€è¦åœ¨çµ‚ç«¯æ©Ÿä¸‹</p>
<pre><code>bundle install
</code></pre>
<p>æˆ–</p>
<pre><code>bundle
</code></pre>
<p>ç‚ºäº†å°‡ line-bot-api é€™å€‹ gem å®‰è£åˆ° Rails å°ˆæ¡ˆä¸­ã€‚</p>
<h3 id="4-å®‰è£-dotenv-rails-è®€å–ç’°å¢ƒè®Šæ•¸"><a href="#4-å®‰è£-dotenv-rails-è®€å–ç’°å¢ƒè®Šæ•¸" class="headerlink" title="4. å®‰è£ dotenv-rails è®€å–ç’°å¢ƒè®Šæ•¸"></a>4. å®‰è£ dotenv-rails è®€å–ç’°å¢ƒè®Šæ•¸</h3><p>å¦å¤–æˆ‘å€‘é‚„éœ€è¦å®‰è£ <a target="_blank" rel="noopener" href="https://github.com/bkeepers/dotenv">dotenv-rails</a> ç”¨ä¾†è¼‰å…¥ .env æ–‡ä»¶ä¸­çš„ç’°å¢ƒè®Šæ•¸ï¼Œä½¿å…¶å¯ä»¥åœ¨å°ˆæ¡ˆä¸­ä»¥ <code>ENV[&#39;ç’°å¢ƒè®Šæ•¸åç¨±&#39;]</code> çš„æ ¼å¼ä½¿ç”¨</p>
<pre><code class="rb"># Gemfile

group :development, :test do
  gem &#39;dotenv-rails&#39;, &#39;~&gt; 3.1&#39;, &#39;&gt;= 3.1.2&#39;
end
</code></pre>
<p>è¨˜å¾—åœ¨çµ‚ç«¯æ©Ÿä¸‹</p>
<pre><code>bundle install
</code></pre>
<p>æˆ–</p>
<pre><code>bundle
</code></pre>
<p>ä½¿é€™å€‹ gem å®‰è£åˆ° Rails å°ˆæ¡ˆä¸­ã€‚</p>
<h3 id="5-åˆå§‹åŒ–-LINE-Bot-å®¢æˆ¶ç«¯"><a href="#5-åˆå§‹åŒ–-LINE-Bot-å®¢æˆ¶ç«¯" class="headerlink" title="5. åˆå§‹åŒ– LINE Bot å®¢æˆ¶ç«¯"></a>5. åˆå§‹åŒ– LINE Bot å®¢æˆ¶ç«¯</h3><p>åœ¨ <code>config/initializers</code> è£¡å»ºç«‹ä¸€å€‹ <code>line_bot.rb</code> çš„æª”æ¡ˆï¼Œæˆ‘å€‘éœ€è¦åˆå§‹åŒ–ä¸€å€‹ LINE_CLIENT ç”¨ä¾†èˆ‡ LINE çš„ Messaging API é€²è¡Œäº’å‹•</p>
<pre><code class="rb"># config/initializers/line_bot.rb

require &#39;line/bot&#39;

LINE_CLIENT = Line::Bot::Client.new do |config|
  config.channel_secret = ENV[&quot;LINE_CHANNEL_SECRET&quot;]
  config.channel_token = ENV[&quot;LINE_CHANNEL_TOKEN&quot;]
end
</code></pre>
<ul>
<li><p><code>require &#39;line/bot&#39;</code>ï¼šå¼•å…¥äº† line-bot-api é€™å€‹ gemï¼Œæä¾›èˆ‡ LINE API äº’å‹•çš„åŠŸèƒ½ã€‚</p>
</li>
<li><p><code>LINE_CLIENT = Line::Bot::Client.new</code>ï¼šå»ºç«‹äº†ä¸€å€‹æ–°çš„ LINE Bot å®¢æˆ¶ç«¯å¯¦é«”ï¼Œä¸¦å°‡å®ƒå„²å­˜åˆ°ä¸€å€‹å¸¸æ•¸ LINE_CLIENT ä¸­ã€‚é€™å€‹å®¢æˆ¶ç«¯æœƒç”¨ä¾†ç™¼é€å’Œæ¥æ”¶ä¾†è‡ª LINE çš„è¨Šæ¯æˆ–äº‹ä»¶ã€‚</p>
</li>
<li><p><code>config.channel_secret = ENV[&quot;LINE_CHANNEL_SECRET&quot;]</code> å’Œ <code>config.channel_token = ENV[&quot;LINE_CHANNEL_TOKEN&quot;]</code>ï¼šè¨­å®šäº† channel_secret å’Œ channel_token å¯†é‘°ï¼Œç”¨ä¾†é©—è­‰èˆ‡ LINE ä¼ºæœå™¨çš„é€šä¿¡ã€‚</p>
</li>
<li><p><code>ENV[&quot;LINE_CHANNEL_SECRET&quot;]</code> å’Œ <code>ENV[&quot;LINE_CHANNEL_TOKEN&quot;]</code>: å¾ç’°å¢ƒè®Šæ•¸ä¸­è®€å–é€™äº›å¯†é‘°ï¼Œç¢ºä¿é€™äº›æ•æ„Ÿè³‡è¨Šä¸æœƒç›´æ¥æš´éœ²åœ¨ç¨‹å¼ç¢¼ä¸­ã€‚</p>
</li>
</ul>
<h2 id="å››ã€æ’°å¯«äº’å‹•é‚è¼¯èˆ‡-API-å›æ‡‰æ©Ÿåˆ¶"><a href="#å››ã€æ’°å¯«äº’å‹•é‚è¼¯èˆ‡-API-å›æ‡‰æ©Ÿåˆ¶" class="headerlink" title="å››ã€æ’°å¯«äº’å‹•é‚è¼¯èˆ‡ API å›æ‡‰æ©Ÿåˆ¶"></a>å››ã€æ’°å¯«äº’å‹•é‚è¼¯èˆ‡ API å›æ‡‰æ©Ÿåˆ¶</h2><h3 id="1-å»ºç«‹-line-callback-è·¯å¾‘"><a href="#1-å»ºç«‹-line-callback-è·¯å¾‘" class="headerlink" title="1. å»ºç«‹ line callback è·¯å¾‘"></a>1. å»ºç«‹ line callback è·¯å¾‘</h3><p>å»ºç«‹ä¸€å€‹ post è·¯å¾‘ï¼Œç”¨ä¾†æ¥æ”¶ LINE Messaging API çš„ callback è¨Šæ¯</p>
<pre><code class="rb"># config/routes.rb

post &#39;/line/callback&#39;, to: &#39;line_bot#callback&#39;
</code></pre>
<h3 id="2-å»ºç«‹-line-controller"><a href="#2-å»ºç«‹-line-controller" class="headerlink" title="2. å»ºç«‹ line controller"></a>2. å»ºç«‹ line controller</h3><p>åœ¨ <code>app/controllers</code> è£¡å»ºç«‹ä¸€å€‹ <code>line_bot_controller.rb</code> æª”æ¡ˆï¼Œä½¿å…¶ç¹¼æ‰¿è‡ª <code>ApplicationController</code>ï¼Œä¸¦ä¸”å®šç¾© <code>callback</code> é€™å€‹ action</p>
<pre><code class="rb"># app/controllers/line_bot_controller.rb

class LineBotController &lt; ApplicationController
  def callback

  end
end
</code></pre>
<h3 id="3-æ¥æ”¶-callback-è¨Šæ¯"><a href="#3-æ¥æ”¶-callback-è¨Šæ¯" class="headerlink" title="3. æ¥æ”¶ callback è¨Šæ¯"></a>3. æ¥æ”¶ callback è¨Šæ¯</h3><p>åƒè€ƒ <a target="_blank" rel="noopener" href="https://github.com/line/line-bot-sdk-ruby?tab=readme-ov-file#synopsis">å®˜æ–¹æ–‡ä»¶</a> ï¼Œé©—è­‰å¾ LINE ä¼ºæœå™¨å‚³ä¾†çš„è«‹æ±‚ï¼Œç¢ºä¿è«‹æ±‚æ˜¯åˆæ³•ä¸”ä¾†è‡ª LINE å®˜æ–¹çš„ã€‚</p>
<pre><code class="rb"># app/controllers/line_bot_controller.rb
class LineBotController &lt; ApplicationController
  skip_before_action :verify_authenticity_token, only: [:callback]

  def callback
    body = request.body.read
    signature = request.headers[&#39;X-Line-Signature&#39;]

    unless LINE_CLIENT.validate_signature(body, signature)
      head :bad_request
        return
    end
  end
end
</code></pre>
<ul>
<li><code>skip_before_action :verify_authenticity_token, only: [:callback]</code>: åœ¨ Rails ä¸­ï¼ŒCSRF æ˜¯ä¸€ç¨®ä¿è­·æ©Ÿåˆ¶ï¼Œç”¨ä¾†é˜²æ­¢è·¨ç«™é»è«‹æ±‚å½é€ æ”»æ“Šï¼Œä½†å› ç‚ºç¾åœ¨éœ€è¦å…è¨±æ¥æ”¶ä¾†è‡ª LINE ä¼ºæœå™¨çš„ webhook è«‹æ±‚ï¼Œæ‰€ä»¥éœ€è¦è®“ Rails å¿½ç•¥å° callback action çš„ CSRF é©—è­‰</li>
<li><code>body = request.body.read</code>: è®€å–å³ LINE ä¼ºæœå™¨å‚³ä¾†çš„å…§å®¹ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨è€…ç™¼é€çš„è¨Šæ¯ã€åŠ å…¥å¥½å‹ç­‰äº‹ä»¶ã€‚</li>
<li><code>signature = request.headers[&#39;X-Line-Signature&#39;]</code>: å¾ LINE è«‹æ±‚çš„æ¨™é ­ä¸­å–å‡º X-Line-Signatureï¼Œé€™æ˜¯ LINE åŠ å¯†ç”Ÿæˆçš„ä¸€å€‹ç°½åï¼Œç”¨ä¾†ç¢ºèªé€™å€‹è«‹æ±‚æ˜¯ä¾†è‡ª LINE çš„ã€‚</li>
<li><code>unless LINE_CLIENT.validate_signature(body, signature)</code>: ä½¿ç”¨ LINE_CLIENT.validate_signature æ–¹æ³•æª¢æŸ¥ body å’Œ signature æ˜¯å¦ç›¸ç¬¦ï¼Œä¸¦é©—è­‰è«‹æ±‚çš„çœŸå¯¦æ€§ã€‚ç‚ºäº†ç¢ºä¿æ”¶åˆ°çš„äº‹ä»¶æˆ–è³‡æ–™æ˜¯ä¾†è‡ª LINE æœ¬èº«ã€‚</li>
<li><code>head :bad_request</code>: å›å‚³ HTTP 400 éŒ¯èª¤ç¢¼è¡¨ç¤ºè«‹æ±‚ç„¡æ•ˆã€‚</li>
</ul>
<h3 id="4-callback-é‚è¼¯"><a href="#4-callback-é‚è¼¯" class="headerlink" title="4. callback é‚è¼¯"></a>4. callback é‚è¼¯</h3><p>ç¢ºèªè¨Šæ¯æ­£ç¢ºå¾Œå¯ä»¥ä¾†å¯«é‚è¼¯ï¼Œå°‡å¾ LINE ä¼ºæœå™¨æ¥æ”¶åˆ°çš„äº‹ä»¶ä¾†åšåˆ†é¡</p>
<pre><code class="rb">def callback
  # ...(ç•¥)
  events = LINE_CLIENT.parse_events_from(body)
  events.each do |event|
    case event
    when Line::Bot::Event::Message
      handle_text_message(event)
    when Line::Bot::Event::Postback
      handle_postback(event)
    end
  end

  head :ok
end
</code></pre>
<ul>
<li><code>LINE_CLIENT.parse_events_from(body)</code>: è§£æä¾†è‡ª LINE çš„è«‹æ±‚ bodyï¼Œå°‡å…¶è½‰æ›ç‚ºäº‹ä»¶é™£åˆ—ã€‚</li>
<li><code>each</code>: ä½¿ç”¨ <code>each</code> è¿´åœˆéæ­· events é™£åˆ—ä¸­çš„æ¯å€‹äº‹ä»¶ã€‚</li>
<li><code>case when</code>: ä½¿ç”¨ <code>case when</code> ä¾†åˆ¤å®š event ä¸åŒè¨Šæ¯æ ¼å¼ï¼Œéœ€è¦åšä»€éº¼äº‹<br>è‹¥æ˜¯ <code>Line::Bot::Event::Message)</code> æ ¼å¼çš„è©±ï¼Œä½¿ç”¨ <code>handle_text_message(event)</code> æ–¹æ³•;<br>è‹¥æ˜¯ <code>Line::Bot::Event::Postback)</code> æ ¼å¼çš„è©±ï¼Œä½¿ç”¨ <code>handle_postback(event)</code> æ–¹æ³•ã€‚</li>
<li><code>head :ok</code>: å›å‚³ HTTP 200 ï¼Œè¡¨ç¤ºäº‹ä»¶å·²æˆåŠŸè™•ç†ã€‚</li>
</ul>
<h3 id="5-handle-text-message-é‚è¼¯"><a href="#5-handle-text-message-é‚è¼¯" class="headerlink" title="5. handle_text_message é‚è¼¯"></a>5. handle_text_message é‚è¼¯</h3><p>å®šç¾© <code>handle_text_message</code> æ–¹æ³•ï¼Œä¾†æ’°å¯«ç•¶æˆ‘å€‘æ”¶åˆ°æ–‡å­—è¨Šæ¯æ™‚çš„é‚è¼¯ã€‚</p>
<pre><code class="rb">def handle_text_message(event)
  user_id = event[&#39;source&#39;][&#39;userId&#39;]
  message = event.message[&#39;text&#39;]

  if message == &#39;å¿ƒç†æ¸¬é©—&#39;
    start_test(user_id)
  else
    reply_message(user_id, &#39;è«‹è¼¸å…¥ã€Œå¿ƒç†æ¸¬é©—ã€å³å¯é–‹å§‹æ¸¬é©—&#39;)
  end
end
</code></pre>
<ul>
<li><code>user_id</code>: å¾ event å–å‡ºç™¼é€è¨Šæ¯çš„ä½¿ç”¨è€… idã€‚</li>
<li><code>message</code>: å¾ event å–å‡ºç™¼é€çš„è¨Šæ¯å…§å®¹ã€‚</li>
<li><code>if...else</code>: ä½¿ç”¨ ifâ€¦else åˆ¤å®šæ¥æ”¶åˆ°çš„è¨Šæ¯æ˜¯å¦ç¬¦åˆ <code>å¿ƒç†æ¸¬é©—</code> å››å€‹å­—<br>æ˜¯çš„è©±åŸ·è¡Œ <code>start_test</code> æ–¹æ³•ï¼Œä¸¦ä¸”æŠŠ <code>user_id</code> ç•¶åƒæ•¸å‚³å…¥;<br>ä¸æ˜¯çš„è©±åŸ·è¡Œ <code>reply_message</code>æ–¹æ³•ï¼Œä¸¦ä¸”æŠŠ <code>user_id</code> è·Ÿ <code>è¦å›å‚³çš„æ–‡å­—å…§å®¹</code> ç•¶åƒæ•¸å‚³å…¥ã€‚</li>
</ul>
<h3 id="6-reply-message-é‚è¼¯"><a href="#6-reply-message-é‚è¼¯" class="headerlink" title="6. reply_message é‚è¼¯"></a>6. reply_message é‚è¼¯</h3><p>å®šç¾© <code>reply_message</code> æ–¹æ³•ï¼Œä¾†æ’°å¯«æˆ‘å€‘æƒ³è¦å›è¦†çµ¦ä½¿ç”¨è€…çš„è¨Šæ¯ã€‚</p>
<pre><code class="rb">def reply_message(user_id, text)
  message = &#123;
    type: &#39;text&#39;,
    text: text
  &#125;
  response = LINE_CLIENT.push_message(user_id, message)

  if response.code != 200
    Rails.logger.error(&quot;éŒ¯èª¤è¨Šæ¯: #&#123;response.body&#125;&quot;)
  end
end
</code></pre>
<ul>
<li><code>message</code>: å®šç¾©å›å‚³çš„è¨Šæ¯æ ¼å¼æ˜¯ textï¼Œä»¥åŠå›å‚³çš„è¨Šæ¯å…§å®¹</li>
<li><code>LINE_CLIENT.push_message(user_id, message)</code>: ç™¼é€è¨Šæ¯çµ¦ä½¿ç”¨è€…</li>
<li><code>Rails.logger.error</code>: å¦‚æœæ²’æœ‰æ­£ç¢ºç™¼é€çš„è©±ï¼Œæœƒå°‡éŒ¯èª¤è¨Šæ¯å°åœ¨ Rails log ä¸­</li>
</ul>
<h3 id="7-start-test-é‚è¼¯"><a href="#7-start-test-é‚è¼¯" class="headerlink" title="7. start_test é‚è¼¯"></a>7. start_test é‚è¼¯</h3><pre><code class="rb">def start_test(user_id)
  questions = Question.order(:id)

  return reply_message(user_id, &#39;ç›®å‰å°šç„¡å¿ƒç†æ¸¬é©—&#39;) if Question.none?

  result = Result.create(user_id: , answers: &#123;&#125;)
  send_question_to_user(user_id, questions.first, result)
end
</code></pre>
<ul>
<li><code>Question.order(:id)</code>: æ‰¾å‡ºæ‰€æœ‰çš„å•é¡Œï¼Œä¸¦ä¸”æ ¹æ“š id å‡åºæ’åˆ—(ç”±å°åˆ°å¤§)ã€‚</li>
<li><code>return reply_message(user_id, &#39;ç›®å‰å°šç„¡å¿ƒç†æ¸¬é©—&#39;) if Question.none?</code>: å¦‚æœå®Œå…¨æ²’æœ‰å•é¡Œæ™‚ï¼Œå›å‚³ <code>ç›®å‰å°šç„¡å¿ƒç†æ¸¬é©—</code> è¨Šæ¯ã€‚</li>
<li><code>Result.create(user_id: , answers: &#123;&#125;)</code>: å»ºç«‹ä¸€å€‹ç©ºçš„å›ç­”ï¼Œä¸¦ä¸”å¯«å…¥ user_id (ä¹‹å¾Œå¯ä»¥å»¶ä¼¸åšæˆï¼Œå·²ç¶“åšéå¿ƒæ¸¬çš„äººï¼Œæœƒç›´æ¥å°å‡ºç­”æ¡ˆä¹‹é¡çš„)</li>
<li><code>send_question_to_user(user_id, questions.first, result)</code>: ä½¿ç”¨ <code>send_question_to_user</code> ç™¼å•é¡Œçµ¦ä½¿ç”¨è€…ï¼Œä¸¦ä¸”æŠŠ <code>ä½¿ç”¨è€… id</code>ã€<code>ç¬¬ä¸€å€‹å•é¡Œ</code>ã€<code>å‰›å‰›å»ºç«‹çš„ç©ºå›ç­”</code> åšç‚ºåƒæ•¸å‚³é€²å»ã€‚</li>
</ul>
<h3 id="8-send-question-to-user-é‚è¼¯"><a href="#8-send-question-to-user-é‚è¼¯" class="headerlink" title="8. send_question_to_user é‚è¼¯"></a>8. send_question_to_user é‚è¼¯</h3><pre><code class="rb">def send_question_to_user(user_id, question, result)
  message = &#123;
    type: &#39;template&#39;,
    altText: question.title,
    template: &#123;
      type: &#39;buttons&#39;,
      text: question.title,
      actions: [
        &#123;
          type: &#39;postback&#39;,
          label: question.option_1,
          data: &quot;question_id=#&#123;question.id&#125;&amp;answer=#&#123;question.value_1&#125;&amp;result_id=#&#123;result.id&#125;&quot;
        &#125;,
        &#123;
          type: &#39;postback&#39;,
          abel: question.option_2,
          data: &quot;question_id=#&#123;question.id&#125;&amp;answer=#&#123;question.value_2&#125;&amp;result_id=#&#123;result.id&#125;&quot;
        &#125;
      ]
    &#125;
  &#125;

  response = LINE_CLIENT.push_message(user_id, message)

  if response.code != 200
    Rails.logger.error(&quot;éŒ¯èª¤è¨Šæ¯: #&#123;response.body&#125;&quot;)
  end
end
</code></pre>
<ul>
<li><code>message</code>: å»ºç«‹æŒ‰éˆ•æ ¼å¼çš„è¨Šæ¯ï¼Œæ”¾å…¥éœ€è¦çš„è³‡æ–™ <a target="_blank" rel="noopener" href="https://developers.line.biz/en/reference/messaging-api/#buttons">åƒè€ƒå®˜æ–¹æ–‡ä»¶</a>ã€‚</li>
</ul>
<h3 id="9-handle-postback-é‚è¼¯"><a href="#9-handle-postback-é‚è¼¯" class="headerlink" title="9. handle_postback é‚è¼¯"></a>9. handle_postback é‚è¼¯</h3><pre><code class="rb">def handle_postback(event)
  data = Rack::Utils.parse_nested_query(event[&#39;postback&#39;][&#39;data&#39;])

  result = Result.find(data[&#39;result_id&#39;])
  question_id = data[&#39;question_id&#39;]
  answer = data[&#39;answer&#39;]

  result.answers[question_id] = answer
  result.save

  next_question = Question.where(&#39;id &gt; ?&#39;, question_id).order(:id).first

  if next_question.present?
    send_question_to_user(event[&#39;source&#39;][&#39;userId&#39;], next_question, result)
  else
    reply_message(event[&#39;source&#39;][&#39;userId&#39;], &quot;æ‚¨çš„æ¸¬é©—çµæœæ˜¯#&#123;result.answers.values.join&#125;&quot;)
  end
end
</code></pre>
<ul>
<li><code>Rack::Utils.parse_nested_query(event[&#39;postback&#39;][&#39;data&#39;])</code>: è§£æ LINE çš„ postback çš„æŸ¥è©¢å­—ä¸²ï¼Œä¸¦å°‡å…¶è½‰æ›ç‚º Hash ç‰©ä»¶ï¼Œæ–¹ä¾¿å¾ŒçºŒæ ¹æ“š key-value ä¾†å­˜å–è³‡æ–™ã€‚</li>
<li><code>Result.find(data[&#39;result_id&#39;])</code>: æ‹¿å– data è£¡çš„ result_idï¼Œä¸¦ä¸”ä½¿ç”¨ <code>.find</code> æ–¹æ³•æ‰¾åˆ°é€™ç­† result è³‡æ–™ã€‚</li>
<li><code>result.answers[question_id] = answer</code>: å°‡ question_id ä½œç‚º keyï¼Œanswer ä½œç‚º value å¯«é€² result è³‡æ–™è£¡ã€‚</li>
<li><code>Question.where(&#39;id &gt; ?&#39;, question_id).order(:id).first</code>: æ‰¾åˆ° id æ¯”ç•¶å‰çš„ question_id æ›´å¤§çš„ question ï¼Œç•¶ä½œä¸‹ä¸€é¡Œé¡Œç›®</li>
<li><code>if ... else</code>:<br>å¦‚æœæœ‰ä¸‹ä¸€é¡Œé¡Œç›® -&gt; ä½¿ç”¨ <code>send_question_to_user</code> ç¹¼çºŒå‚³ä¸‹ä¸€é¡Œçµ¦ä½¿ç”¨è€…;<br>å¦‚æœæ²’æœ‰ -&gt; ä½¿ç”¨ <code>reply_message</code> å‚³é€æ¸¬é©—çµæœçµ¦ä½¿ç”¨è€…ã€‚</li>
<li><code>result.answers.values.join</code>: å°‡é€™ç­† result çš„ answers æ¬„ä½ä½¿ç”¨ <code>.values</code> æ–¹æ³•ï¼Œæ‹¿å‡ºæ‰€æœ‰çš„ value ï¼Œä¸¦ä¸”ä½¿ç”¨ <code>.join</code> æ–¹æ³•å°‡å…¶çµ„æˆå­—ä¸²ã€‚</li>
</ul>
<h2 id="äº”ã€é–‹å•Ÿ-NGROK-amp-è¨­å®š-LINE-BOT-CALLBACK"><a href="#äº”ã€é–‹å•Ÿ-NGROK-amp-è¨­å®š-LINE-BOT-CALLBACK" class="headerlink" title="äº”ã€é–‹å•Ÿ NGROK &amp; è¨­å®š LINE BOT CALLBACK"></a>äº”ã€é–‹å•Ÿ NGROK &amp; è¨­å®š LINE BOT CALLBACK</h2><h3 id="1-å•Ÿå‹•-ngrok-ç›£è½-3000-port"><a href="#1-å•Ÿå‹•-ngrok-ç›£è½-3000-port" class="headerlink" title="1. å•Ÿå‹• ngrok ç›£è½ 3000 port"></a>1. å•Ÿå‹• ngrok ç›£è½ 3000 port</h3><p>Ngrok æ˜¯ä¸€å€‹å·¥å…·ï¼Œèƒ½å°‡æœ¬æ©Ÿæœå‹™ç”Ÿæˆä¸€å€‹å…¬é–‹çš„ç¶²å€ï¼Œè®“å¤–éƒ¨è¨­å‚™æˆ–æœå‹™ï¼ˆå¦‚ LINE Messaging APIï¼‰èƒ½å¤ è¨ªå•ä½ åœ¨æœ¬æ©Ÿé‹è¡Œçš„æ‡‰ç”¨ç¨‹å¼ã€‚</p>
<p>è‹¥é‚„æ²’å®‰è£å¯ä»¥åƒè€ƒ <a target="_blank" rel="noopener" href="https://ngrok.com/docs/getting-started/">å®˜æ–¹æ–‡ä»¶</a> å®‰è£ä¸¦ä¸”é€£çµå¸³æˆ¶ã€‚</p>
<p>è‹¥å®‰è£å®Œæˆå³å¯ç›´æ¥ä½¿ç”¨ <code>ngrok http 3000</code> ä¾†è®“ ngrok ç›£è½ 3000 port</p>
<pre><code>ngrok http 3000
</code></pre>
<p>æœƒçœ‹åˆ°ä»¥ä¸‹ç•«é¢</p>
<p><img src="/image/railsLinePsychological/8.png" alt="ngrok http 3000"></p>
<p>æˆ‘å€‘å¯ä»¥æ‹¿å–é»ƒæ¡†æ¡†å…§ ngrok æä¾›çš„ç¶²å€<code>5c55-2001-b011-4004-5d2a-f037-8f83-82eb-8357.ngrok-free.app</code><br>ğŸ“ æ¯å€‹äººç”Ÿæˆçš„æœƒä¸åŒï¼Œéœ€æ›æˆè‡ªå·±ç”Ÿæˆçš„</p>
<h3 id="2-å°‡ç¶²å€æ”¾é€²ç’°å¢ƒè®Šæ•¸"><a href="#2-å°‡ç¶²å€æ”¾é€²ç’°å¢ƒè®Šæ•¸" class="headerlink" title="2. å°‡ç¶²å€æ”¾é€²ç’°å¢ƒè®Šæ•¸"></a>2. å°‡ç¶²å€æ”¾é€²ç’°å¢ƒè®Šæ•¸</h3><pre><code class="rb">#.env
HOSTNAME=5c55-2001-b011-4004-5d2a-f037-8f83-82eb-8357.ngrok-free.app
</code></pre>
<h3 id="3-è¨­å®šå°ˆæ¡ˆçš„-hosts"><a href="#3-è¨­å®šå°ˆæ¡ˆçš„-hosts" class="headerlink" title="3. è¨­å®šå°ˆæ¡ˆçš„ hosts"></a>3. è¨­å®šå°ˆæ¡ˆçš„ hosts</h3><p>åœ¨ development ç’°å¢ƒè¨­ç½® HOSTNAME ï¼Œæœ‰å…¬é–‹çš„ç¶²å€ LINE æ‰èƒ½æ­£ç¢ºå¯„é€ callback</p>
<pre><code class="rb"># config/environments/development.rb
config.hosts &lt;&lt; ENV[&#39;HOSTNAME&#39;] if ENV[&#39;HOSTNAME&#39;].present?
</code></pre>
<h3 id="4-è¨­å®š-LINE-Messaging-API-Webhook-URL"><a href="#4-è¨­å®š-LINE-Messaging-API-Webhook-URL" class="headerlink" title="4. è¨­å®š LINE Messaging API Webhook URL"></a>4. è¨­å®š LINE Messaging API Webhook URL</h3><p>å»è¨­å®šé é¢æ‰¾åˆ° <code>Messaging API</code> çš„ <code>Webhook URL</code> å°‡æˆ‘å€‘çš„ç¶²å€<code>https://5c55-2001-b011-4004-5d2a-f037-8f83-82eb-8357.ngrok-free.app/line/callback</code> è¨­å®šä¸¦å„²å­˜ã€‚</p>
<p>ğŸ“ <code>5c55-2001-b011-4004-5d2a-f037-8f83-82eb-8357.ngrok-free.app</code>æ¯å€‹äººç”Ÿæˆçš„æœƒä¸åŒï¼Œéœ€æ›æˆè‡ªå·±ç”Ÿæˆçš„<br>ğŸ“ <code>/line/callback</code> è·¯å¾‘åˆ¥å¿˜è¨˜åŠ ä¸Š</p>
<p><img src="/image/railsLinePsychological/9.png" alt="è¨­å®š LINE Messaging API Webhook URL"></p>
<h3 id="5-é‡é–‹-server-ä¸¦é–‹å•Ÿ-LINE-å®˜æ–¹å¸³è™Ÿè©¦è©¦"><a href="#5-é‡é–‹-server-ä¸¦é–‹å•Ÿ-LINE-å®˜æ–¹å¸³è™Ÿè©¦è©¦" class="headerlink" title="5. é‡é–‹ server ä¸¦é–‹å•Ÿ LINE å®˜æ–¹å¸³è™Ÿè©¦è©¦"></a>5. é‡é–‹ server ä¸¦é–‹å•Ÿ LINE å®˜æ–¹å¸³è™Ÿè©¦è©¦</h3><p><img src="/image/railsLinePsychological/10.png" alt="å°šæœªå»ºç«‹å•é¡Œ"></p>
<h3 id="6-å»ºç«‹å•é¡Œ"><a href="#6-å»ºç«‹å•é¡Œ" class="headerlink" title="6. å»ºç«‹å•é¡Œ"></a>6. å»ºç«‹å•é¡Œ</h3><p>ä»¥ä¸‹ç‚ºæˆ‘çš„ç¯„ä¾‹å•é¡Œï¼Œå¯ä»¥åœ¨ <code>http://localhost:3000/questions/new</code> æ–°å¢å•é¡Œ</p>
<table>
<thead>
<tr>
<th>title</th>
<th>Option 1</th>
<th>Option 2</th>
<th>Value 1</th>
<th>Value 2</th>
</tr>
</thead>
<tbody><tr>
<td>ç•¶æˆ‘åƒåŠ ä¸€å€‹å…§æœ‰ä¸€åŠçš„äººä¸ç†Ÿçš„èšæœƒå¾Œï¼Œæˆ‘æ„Ÿåˆ°</td>
<td>èªè­˜å¾ˆå¤šæ–°æœ‹å‹ï¼Œè®“æˆ‘å……æ»¿èƒ½é‡ï¼ï¼</td>
<td>è·Ÿä¸ç†Ÿçš„äººäº¤æµï¼Œæˆ‘éœ€è¦ä¼‘æ¯ã€å……é›»</td>
<td>E</td>
<td>I</td>
</tr>
<tr>
<td>å¿«è¦è€ƒè©¦äº†ä½†è‡ªå·±å®Œå…¨æ²’è¤‡ç¿’æ™‚ï¼Œè…¦ä¸­æœƒæœ‰ä»€éº¼æƒ³æ³•ï¼Ÿ</td>
<td>å¦‚ä½•åœ¨æ™‚é–“å…§ï¼Œè¦åŠƒæœ€å¤§åŒ–æŠ±ä½›è…³æ•ˆç›Š</td>
<td>äººç‚ºä»€éº¼å­˜åœ¨ï¼Ÿç‚ºä½•éœ€è¦è€ƒè©¦ï¼Ÿ</td>
<td>S</td>
<td>N</td>
</tr>
<tr>
<td>æœ‹å‹å‘Šè¨´ä½ ï¼šã€Œæˆ‘ä»Šå¤©å¿ƒæƒ…ä¸å¥½ï¼Œæ‰€ä»¥å»è²·äº†ç”œé»åƒã€ï¼Œä½ çš„å›æ‡‰æ˜¯</td>
<td>è²·ä»€éº¼ç”œé»åƒï¼Ÿ</td>
<td>ä½ å¿ƒæƒ…ä¸å¥½ï¼Ÿæ€éº¼äº†ï¼Ÿ</td>
<td>T</td>
<td>F</td>
</tr>
<tr>
<td>ä»Šæ—¥ä¸Šç­å¾…è¾¦æ¸…å–®æœ‰ä¸€å¤§å †ï¼Œä½ æœƒå¦‚ä½•è¦åŠƒ</td>
<td>æ ¹æ“šè¼•é‡ç·©æ€¥åˆ†é…ï¼Œä¸¦æŒ‰è¨ˆç•«åŸ·è¡Œ</td>
<td>åšä¸€å€‹å‹¾ä¸€å€‹ï¼Œä¸­é–“ä¹Ÿæœƒé©åº¦ä¼‘æ¯ï½</td>
<td>J</td>
<td>P</td>
</tr>
</tbody></table>
<p>æ–°å¢æˆåŠŸå¾Œå¯ä»¥åœ¨ LINE å®˜æ–¹å¸³è™Ÿçœ‹åˆ°æˆ‘å€‘è‡ªè£½çš„å¿ƒç†æ¸¬é©— ğŸ‰ğŸ‰ğŸ‰<br><img src="/image/railsLinePsychological/11.png" alt="è‡ªè£½å¿ƒç†æ¸¬é©—"></p>
<p>è‹¥æƒ³è¦çœ‹ç¨‹å¼ç¢¼å¯ä»¥åƒè€ƒæˆ‘çš„ <a target="_blank" rel="noopener" href="https://github.com/Kkrystalll/psychologicalTest">GitHub repo</a>ã€‚</p>

  </div>
  <div id=""></div>
</div>

<script>
  Fancybox.bind('[data-fancybox="fancybox-gallery-img"]', {
    dragToClose: true,
    Toolbar: true,
    closeButton: "top",
    Image: {
      zoom: true,
    },
    on: {
      initCarousel: (fancybox) => {
        const slide = fancybox.Carousel.slides[fancybox.Carousel.page];
        fancybox.$container.style.setProperty(
          "--bg-image",
          `url("${slide.$thumb.src}")`
        );
      },
      "Carousel.change": (fancybox, carousel, to, from) => {
        const slide = carousel.slides[to];
        fancybox.$container.style.setProperty(
          "--bg-image",
          `url("${slide.$thumb.src}")`
        );
      },
    },
  });
</script>

<style>
  #noneimg img {
    display: none;
    z-index: 9999;
    /* width: 600px !important; */
    min-width: 0%;
    max-width: 90%;
    max-height: 80%;
    border-radius: 0px;
    position: fixed;
    box-shadow: 0 0 0px #c3c3c300 !important;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    margin: auto !important;
  }

  @media screen and (max-width: 600px) {
    #noneimg img {
      max-width: 88%;
    }
  }
</style>

    <div class="post-paging">
    

    
    <a href="/posts/create-line-official-account/">
        <div class="post-paging-next">
            <span>ä¸‹ä¸€ç¯‡</span>
            <p>è¶…å…¨å»ºç«‹ LINE å®˜æ–¹å¸³è™Ÿæµç¨‹</p>
        </div>
    </a>
    
</div>
</div>
		<div class="footer">
  <div class="Copyright">
    Â©2024 By Krystal. ä¸»é¢˜ï¼š<a
      style="text-decoration: none; display: contents; color: #898f9f"
      target="_blank" rel="noopener" href="https://github.com/79e/hexo-theme-quiet"
      >Quiet</a
    >
  </div>
  <div class="contact">
    
    <a target="_blank" rel="noopener" href="https://github.com/Kkrystalll">
      <img src="https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg/imggithub.png" alt="Quietä¸»é¢˜" />
    </a>
    
  </div>
</div>

<script src="/js/gotop.js"></script>


<style type="text/css">
    @media screen and (min-width: 600px) {
        .goTop>span {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            opacity: 0.8;
            background: rgba(18, 24, 58, 0.06);
            text-align: center;
            transition: border .5s;
            border: 1px solid rgba(18, 24, 58, 0.06);

            -moz-transition: border .5s;
            /* Firefox 4 */
            -webkit-transition: border .5s;
            /* Safari å’Œ Chrome */
            -o-transition: border .5s;
            /* Opera */
        }

        .goTop>span:hover {
            border: 1px solid #6680B3;
        }


        .goTop {
            position: fixed;
            right: 30px;
            bottom: 80px;
        }

        .goTop>span>svg {
            width: 20px;
            height: 20px;
            opacity: 0.7;
        }

    }

    @media screen and (max-width: 600px) {
        .goTop {
            display: none;
        }
    }
</style>
<div class="goTop" id="js-go_top">
    <span>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <g>
                <path d="M13 12v8h-2v-8H4l8-8 8 8z"></path>
            </g>
        </svg>
    </span>
</div>
<script>
    $( '#js-go_top' )
	.gotoTop( {
		offset: 500,
		speed: 300,
		animationShow: {
			'transform': 'translate(0,0)',
			'transition': 'transform .5s ease-in-out'
		},
		animationHide: {
			'transform': 'translate(100px,0)',
			'transition': 'transform .5s ease-in-out'
		}
	} );
</script>  
    <!-- Gitalk -->
    <script>
        const data = '{"clientID":"02b3c","clientSecret":"adfc7b4","repo":"gimment","owner":"duneng","admin":"duneng"}'
        const gitalk = new Gitalk({
            ...JSON.parse( data),
            id:location.pathname,
            distractionFreeMode:false
        })
        
        if(Boolean('false')){
            gitalk.render('gitalk-container')
        }
    </script>


	</body>
</html>

